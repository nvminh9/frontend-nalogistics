<div class="dashboard-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1 class="header-title">
        <span class="icon">üöõ</span>
        Dashboard Qu·∫£n L√Ω V·∫≠n T·∫£i
      </h1>
      
      <div class="header-controls">
        <!-- View Mode Selector -->
        <select class="view-selector">
          <option value="truck-statistics">Truck Statistics</option>
          <option value="maintenance">Maintenance</option>
          <option value="routes">Routes Analysis</option>
          <option value="fuel">Fuel Management</option>
        </select>
        
        <!-- Connection Status -->
        <div class="connection-status status-connected">
          <div class="status-dot pulse"></div>
          <span>Live Data</span>
        </div>

        <!-- Last Updated -->
        <div class="last-updated fresh">
          <span class="icon">üïí</span>
          <span>{{ getTimeAgo() }}</span>
        </div>

        <!-- Refresh Button -->
        <button class="btn btn-refresh" (click)="onRefreshData()">
          <span class="icon">üîÑ</span>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="!truckStatistics" class="loading-state">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu t·ª´ WebSocket...</p>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="truckStatistics" class="dashboard-content">
    
    <!-- Stats Grid -->
    <div class="stats-grid">
      <!-- Total Orders Card -->
      <div class="stat-card orders" (click)="onStatCardClick('orders', $event)">
        <div class="stat-icon">üì¶</div>
        <div class="stat-value">{{ truckStatistics.totalCompletedOrder }}</div>
        <div class="stat-label">T·ªïng ƒë∆°n h√†ng ho√†n th√†nh</div>
        <div class="stat-detail">C·∫≠p nh·∫≠t real-time</div>
      </div>

      <!-- Best Truck Card -->
      <div class="stat-card top-truck" (click)="onStatCardClick('top-truck', $event)">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-value">{{ truckStatistics.mostTrip.truckNo || 'N/A' }}</div>
        <div class="stat-label">Xe xu·∫•t s·∫Øc nh·∫•t</div>
        <div class="stat-detail">{{ truckStatistics.mostTrip.countCompletedTrip }} chuy·∫øn ho√†n th√†nh</div>
      </div>

      <!-- Average Performance Card -->
      <div class="stat-card performance" (click)="onStatCardClick('performance', $event)">
        <div class="stat-icon">üìä</div>
        <div class="stat-value">{{ avgPerformance }}</div>
        <div class="stat-label">Trung b√¨nh chuy·∫øn/xe</div>
        <div class="stat-detail">Hi·ªáu su·∫•t ƒë·ªôi xe</div>
      </div>

      <!-- Active Fleet Card -->
      <div class="stat-card fleet" (click)="onStatCardClick('fleet', $event)">
        <div class="stat-icon">üöõ</div>
        <div class="stat-value">{{ truckStatistics.topTrucks.length }}</div>
        <div class="stat-label">Xe ƒëang ho·∫°t ƒë·ªông</div>
        <div class="stat-detail">To√†n b·ªô ƒë·ªôi xe</div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="details-grid">
      
      <!-- Top Trucks Section -->
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">
            <span class="icon">üèÖ</span>
            Top {{ truckStatistics.topTrucks.length }} Xe T·ªët Nh·∫•t
          </h2>
          <div class="section-actions">
            <span class="section-badge">{{ truckStatistics.topTrucks.length }} xe</span>
            <button class="btn btn-export">üìä Export</button>
          </div>
        </div>

        <div class="trucks-container">
          <div 
            *ngFor="let truck of truckStatistics.topTrucks; trackBy: trackByTruckId; let i = index"
            class="truck-item"
            [ngClass]="getTruckPerformanceClass(i)"
            (click)="onTruckClick(truck, $event)"
            [attr.tabindex]="0"
            (keydown.enter)="onTruckClick(truck, $event)"
          >
            <div class="truck-rank">{{ getTruckRank(i) }}</div>
            
            <div class="truck-info">
              <div class="truck-number">{{ truck.truckNo || 'Ch∆∞a c√≥ bi·ªÉn s·ªë' }}</div>
              <div class="truck-id">ID: {{ truck.truckID }}</div>
            </div>
            
            <div class="truck-stats">
              <div class="trip-count">{{ truck.countCompletedTrip }}</div>
              <div class="trip-label">chuy·∫øn</div>
              
              <!-- Progress Bar Based on Real Data -->
              <div class="progress-bar">
                <div 
                  class="progress-fill" 
                  [style.width.%]="(truck.countCompletedTrip / truckStatistics.mostTrip.countCompletedTrip) * 100"
                ></div>
              </div>
            </div>

            <div class="truck-arrow">‚Üí</div>
          </div>

          <!-- Empty State -->
          <div *ngIf="truckStatistics.topTrucks.length === 0" class="empty-state">
            <div class="empty-icon">üöõ</div>
            <p>Ch∆∞a c√≥ d·ªØ li·ªáu xe</p>
          </div>
        </div>
      </div>

      <!-- Performance & Charts Section -->
      <div class="charts-section">
        
        <!-- Performance Summary -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="icon">üìà</span>
              Ph√¢n T√≠ch Hi·ªáu Su·∫•t
            </h2>
          </div>

          <div class="performance-container">
            <!-- Best Performance -->
            <div class="performance-item best">
              <div class="performance-header">
                <span class="performance-icon">ü•á</span>
                <span class="performance-label">Xe xu·∫•t s·∫Øc nh·∫•t</span>
              </div>
              <div class="performance-content">
                <div class="performance-truck">{{ truckStatistics.mostTrip.truckNo || 'Ch∆∞a x√°c ƒë·ªãnh' }}</div>
                <div class="performance-stats">
                  <span class="performance-number">{{ truckStatistics.mostTrip.countCompletedTrip }}</span>
                  <span class="performance-unit">chuy·∫øn</span>
                </div>
              </div>
            </div>

            <!-- Worst Performance -->
            <div class="performance-item worst">
              <div class="performance-header">
                <span class="performance-icon">üìâ</span>
                <span class="performance-label">Xe c·∫ßn c·∫£i thi·ªán</span>
              </div>
              <div class="performance-content">
                <div class="performance-truck">{{ truckStatistics.leastTrip.truckNo || 'Ch∆∞a x√°c ƒë·ªãnh' }}</div>
                <div class="performance-stats">
                  <span class="performance-number">{{ truckStatistics.leastTrip.countCompletedTrip }}</span>
                  <span class="performance-unit">chuy·∫øn</span>
                </div>
              </div>
            </div>

            <!-- Average Performance -->
            <div class="performance-item average">
              <div class="performance-header">
                <span class="performance-icon">üìä</span>
                <span class="performance-label">Hi·ªáu su·∫•t trung b√¨nh</span>
              </div>
              <div class="performance-content">
                <div class="performance-truck">To√†n ƒë·ªôi xe</div>
                <div class="performance-stats">
                  <span class="performance-number">{{ avgPerformance }}</span>
                  <span class="performance-unit">chuy·∫øn/xe</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real Data Distribution Chart -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="icon">üìä</span>
              Ph√¢n B·ªë Hi·ªáu Su·∫•t
            </h2>
          </div>

          <div class="chart-container">
            <!-- Simple Chart Using Real Data -->
            <div class="distribution-chart">
              <div 
                *ngFor="let truck of truckStatistics.topTrucks; let i = index" 
                class="chart-bar"
                [style.height.%]="(truck.countCompletedTrip / truckStatistics.mostTrip.countCompletedTrip) * 100"
                [attr.title]="truck.truckNo + ': ' + truck.countCompletedTrip + ' chuy·∫øn'"
              >
                <div class="bar-value">{{ truck.countCompletedTrip }}</div>
                <div class="bar-label">{{ truck.truckNo }}</div>
              </div>
            </div>

            <!-- Legend Based on Real Data -->
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color excellent"></span>
                <span>Xu·∫•t s·∫Øc ({{ getExcellentCount() }} xe)</span>
              </div>
              <div class="legend-item">
                <span class="legend-color good"></span>
                <span>T·ªët ({{ getGoodCount() }} xe)</span>
              </div>
              <div class="legend-item">
                <span class="legend-color average"></span>
                <span>Trung b√¨nh ({{ getAverageCount() }} xe)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Trip Distribution Stats -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="icon">üìã</span>
              Th·ªëng K√™ Chi Ti·∫øt
            </h2>
          </div>

          <div class="stats-detail">
            <div class="detail-item">
              <span class="detail-label">T·ªïng s·ªë chuy·∫øn:</span>
              <span class="detail-value">{{ getTotalTrips() }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Xe ho·∫°t ƒë·ªông:</span>
              <span class="detail-value">{{ truckStatistics.topTrucks.length }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hi·ªáu su·∫•t cao nh·∫•t:</span>
              <span class="detail-value">{{ truckStatistics.mostTrip.countCompletedTrip }} chuy·∫øn</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Hi·ªáu su·∫•t th·∫•p nh·∫•t:</span>
              <span class="detail-value">{{ truckStatistics.leastTrip.countCompletedTrip }} chuy·∫øn</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>