<div class="customer-container">
  <!-- Header -->
  <div class="page-header">
    <div class="page-title">
      <div class="page-icon">üë•</div>
      <h1>Danh m·ª•c Ng∆∞·ªùi d√πng</h1>
    </div>
    <button class="btn-add" (click)="openAddModal()">
      <span>‚ûï</span>
      <span>Th√™m m·ªõi</span>
    </button>
  </div>

  <!-- Simple Filter -->
  <div class="simple-filter">
    <div class="search-box">
      <input 
        type="text" 
        class="search-input" 
        id="searchInput"
        placeholder="üîç T√¨m ki·∫øm theo t√™n, m√£ ng∆∞·ªùi d√πng, SƒêT..." (input)="searchUser($event)">
    </div>
    <select class="sort-select" id="sortSelect" (change)="sortData($event)">
      <option value="id-old">Ng√†y t·∫°o (c≈© nh·∫•t)</option>
      <option value="id-new">Ng√†y t·∫°o (m·ªõi nh·∫•t)</option>
      <option value="name-az">T√™n (A-Z)</option>
      <option value="name-za">T√™n (Z-A)</option>
    </select>
    <select class="sort-select" id="entriesSelect" (change)="showEntries($event)">
      <option value="30">S·ªë l∆∞·ª£ng hi·ªÉn th·ªã 30</option>
      <option value="35">35</option>
      <option value="40">40</option>
      <option value="50">50</option>
    </select>
    <select class="sort-select" id="entriesSelect" (change)="filterRole($event)">
      <option [value]="0">T·∫•t c·∫£ quy·ªÅn</option>
      <option *ngFor="let r of listRole" [value]="r.roleID">{{r.roleName}}</option>
    </select>
  </div>

  <!-- Table -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>T√™n ng∆∞·ªùi d√πng</th>
          <th>Quy·ªÅn</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="customerTableBody">
        <tr *ngFor="let user of listUser">
          <td>{{user.userID}}</td>
          <td>{{user.userName}}</td>
          <td>{{user.fullName}}</td>

          <td *ngIf="user.roleID == 1">Admin</td> 
          <td *ngIf="user.roleID == 2">User</td> 
          <td *ngIf="user.roleID == 3">Driver</td> 
          <td *ngIf="user.roleID == 4">Customer</td> 
          <td *ngIf="user.roleID == 5">Entry</td> 
          <td *ngIf="user.roleID == 6">Operator</td> 
          <td *ngIf="user.roleID == 7">Accountant</td> 
          <td *ngIf="user.roleID == 8">Approver</td> 
          <td *ngIf="user.roleID == 9">Ngu·ªùi khai b√°o chi ph√≠ B·∫£o d∆∞·ª°ng</td> 

          <td>
            <div class="action-buttons">
                <button class="btn-action btn-edit" (click)="openDetailModal(user.userID)">Chi ti·∫øt</button>
                <button class="btn-action btn-delete" (click)="DeleteUser(user.userID)">X√≥a</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Add -->
<div class="modal-overlay" [class.show]="isAddModalOpen" (click)="onOverlayClick($event, 'add')">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">{{modalTitle}}</h2>
      <button class="modal-close" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="customerForm" (ngSubmit)="saveUser()">
        <!-- Username -->
        <div class="form-group">
          <label class="form-label">
            T√™n ƒëƒÉng nh·∫≠p <span class="required">*</span>
          </label>
          <input type="text" class="form-input" id="userName" [(ngModel)]="userForm.userName" name="userName" required>
        </div>

        <!-- Password -->
        <div class="form-group">
          <label class="form-label">
            M·∫≠t kh·∫©u <span class="required">*</span>
          </label>
          <input type="password" class="form-input" id="password" [(ngModel)]="userForm.password" name="password" required>
        </div>

        <!-- Full Name -->
        <div class="form-group">
          <label class="form-label">
            H·ªç v√† t√™n <span class="required">*</span>
          </label>
          <input type="text" class="form-input" id="fullName" [(ngModel)]="userForm.fullName" name="fullName" required>
        </div>  
        
        <div class="form-group">
          <label class="form-label">
            Quy·ªÅn h·∫°n
          </label>
          <select class="form-input" [(ngModel)]="userForm.roleID" name="roleID">
            <option *ngFor="let r of listRole" [value]="r.roleID" >{{r.roleName}}</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeAddModal()">H·ªßy</button>
          <button type="submit" class="btn-save">{{isEditMode ? 'C·∫≠p nh·∫≠t' : 'L∆∞u'}}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Chi ti·∫øt -->
<div class="modal-overlay" [class.show]="isDetailModalOpen" (click)="onOverlayClick($event, 'detail')">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Chi ti·∫øt Ng∆∞·ªùi d√πng</h2>
      <button class="modal-close" (click)="closeDetailModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="currentUser; else loadingTemplate">
      <form id="detailCustomerForm" >
        <!-- ID kh√°ch h√†ng - READ ONLY -->
        <div class="form-group">
          <label class="form-label">ID Ng∆∞·ªùi d√πng:</label>
          <input 
            type="text" 
            class="form-input readonly" 
            [(ngModel)]="currentUser.userID" 
            name="userID"
            readonly>
        </div>

        <!-- Username -->
        <div class="form-group">
          <label class="form-label">
            Username<span class="required">*</span>
          </label>
          <input type="text" class="form-input" id="userName" [(ngModel)]="currentUser.userName" name="userName" readonly>
        </div>

        <!-- Password - C√ì TH·ªÇ EDIT -->
        <div class="form-group">
          <label class="form-label">
            M·∫≠t kh·∫©u ( Ctrl + Z ƒë·ªÉ ho√†n l·∫°i m·∫≠t kh·∫©u ban ƒë·∫ßu)<span class="required">*</span>
          </label>
          <input type="text" class="form-input" [(ngModel)]="currentUser.password" name="password" required>
        </div>

        <!-- M√£ kh√°ch h√†ng - C√ì TH·ªÇ EDIT -->
        <div class="form-group">
          <label class="form-label">
            H·ªç v√† t√™n ng∆∞·ªùi d√πng <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="currentUser.fullName" 
            name="fullName"
            required>
        </div>

        <div class="form-group">
          <label class="form-label">
            Quy·ªÅn h·∫°n
          </label>
          <select class="form-input" [(ngModel)]="currentUser.roleID" name="roleID">
            <option *ngFor="let r of listRole" [value]="r.roleID" >{{r.roleName}}</option>
          </select>
        </div>
      </form>
    </div>
             
    <!-- Loading template -->
    <ng-template #loadingTemplate>
      <div class="modal-body loading-container">
        <div class="loading"></div>
        <p>ƒêang t·∫£i th√¥ng tin...</p>
      </div>
    </ng-template>
             
    <div class="modal-footer" *ngIf="currentUser">
      <button type="button" class="btn-secondary" (click)="closeDetailModal()">ƒê√≥ng</button>
      <button type="button" class="btn-primary" (click)="updateUserFromDetail(currentUser.userID)">C·∫≠p nh·∫≠t</button>
    </div>
  </div>
</div>



<div class="pagination-container pagination-fade-in">
    <!-- Info Text -->
    <div class="pagination-info">
        T·ªïng <strong>1-10</strong> c·ªßa <strong>156</strong> k·∫øt qu·∫£
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
        <!-- Previous Button -->
        <button class="pagination-btn nav-btn prev" 
                [disabled]="pageNumber === 1"
                (click)="changePage(pageNumber - 1)">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Tr∆∞·ªõc
        </button>

        <!-- Page Numbers -->
        <button class="pagination-btn" 
                [class.active]="pageNumber === 1"
                (click)="changePage(1)">1</button>
        <button class="pagination-btn" 
                [class.active]="pageNumber === 2"
                (click)="changePage(2)">2</button>
        <button class="pagination-btn" 
                [class.active]="pageNumber === 3"
                (click)="changePage(3)">3</button>
        <button class="pagination-btn mobile-hidden" 
                [class.active]="pageNumber === 4"
                (click)="changePage(4)">4</button>
        <button class="pagination-btn mobile-hidden" 
                [class.active]="pageNumber === 5"
                (click)="changePage(5)">5</button>

        <!-- Ellipsis -->
        <span class="pagination-ellipsis mobile-hidden">...</span>

        <!-- Last Page -->
        <button class="pagination-btn mobile-hidden" 
                [class.active]="pageNumber === 16"
                (click)="changePage(16)">16</button>

        <!-- Next Button -->
        <button class="pagination-btn nav-btn next"
                [disabled]="pageNumber === 16"
                (click)="changePage(pageNumber + 1)">
            Sau
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
        </button>
    </div>
</div>

<script>
    // Basic functionality for demonstration
    document.addEventListener('DOMContentLoaded', function() {
        const paginationBtns = document.querySelectorAll('.pagination-btn:not(.nav-btn)');
        const prevBtn = document.querySelector('.pagination-btn.prev');
        const nextBtn = document.querySelector('.pagination-btn.next');
        const pageSizeSelect = document.getElementById('pageSize');

        // Page number click handling
        paginationBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                paginationBtns.forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Add animation
                this.classList.add('pagination-slide-in');
                setTimeout(() => {
                    this.classList.remove('pagination-slide-in');
                }, 300);
            });
        });

        // Page size change handling
        pageSizeSelect.addEventListener('change', function() {
            console.log('Page size changed to:', this.value);
            // Add your page size change logic here
        });

        // Navigation button handling
        prevBtn.addEventListener('click', function() {
            console.log('Previous page clicked');
            // Add your previous page logic here
        });

        nextBtn.addEventListener('click', function() {
            console.log('Next page clicked');
            // Add your next page logic here
        });
    });
</script>