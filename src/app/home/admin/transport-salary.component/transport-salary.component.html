<div class="driver-container">
    <!-- Header -->
    <div class="page-header">
        <div class="page-title">
            <div class="page-icon">üöó</div>
            <h1>Ti·ªÅn l∆∞∆°ng v·∫≠n chuy·ªÉn</h1>
        </div>
        <button class="btn-add" (click)="openAddModal()">
            <span>‚ûï</span>
            <span>Th√™m m·ªõi</span>
        </button>
    </div>

    <!-- Simple Filter -->
    <div class="simple-filter">
        <!-- C·∫£ng nh·∫≠n Cont Filter -->
        <div class="filter-group">
            <label class="filter-label">C·∫£ng nh·∫≠n Cont</label>
            <div class="dropdown-container">
                <div class="dropdown-wrapper" [class.active]="filterDropdownStates.fromLocation">
                    <input 
                        type="text" 
                        class="dropdown-search filter-dropdown" 
                        placeholder="Ch·ªçn c·∫£ng nh·∫≠n..."
                        [value]="filterSearchTerms.fromLocation || getSelectedLocationName(FromLocationId)"
                        (focus)="openFilterDropdown('fromLocation')"
                        (input)="onFilterSearchLocation($event, 'fromLocation')"
                        (click)="openFilterDropdown('fromLocation')">
                    <span class="dropdown-arrow" (click)="toggleFilterDropdown('fromLocation')">‚ñº</span>
                    
                    <div class="dropdown-list" *ngIf="filterDropdownStates.fromLocation">
                        <div class="dropdown-item" 
                             (click)="selectFilterLocation({locationId: 0, locationName: 'Kh√¥ng ch·ªçn'}, 'fromLocation')"
                             [class.selected]="FromLocationId === 0">
                            Kh√¥ng ch·ªçn
                        </div>
                        <div class="dropdown-item" 
                             *ngFor="let l of filteredFilterLocations.fromLocation" 
                             (click)="selectFilterLocation(l, 'fromLocation')"
                             [class.selected]="FromLocationId === l.locationId">
                            {{l.locationName}}
                        </div>
                        <div *ngIf="filteredFilterLocations.fromLocation.length === 0" class="no-results">
                            Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kho nh·∫≠n/Giao h√†ng Filter -->
        <div class="filter-group">
            <label class="filter-label">Kho nh·∫≠n/Giao h√†ng</label>
            <div class="dropdown-container">
                <div class="dropdown-wrapper" [class.active]="filterDropdownStates.fromWhere">
                    <input 
                        type="text" 
                        class="dropdown-search filter-dropdown" 
                        placeholder="Ch·ªçn kho..."
                        [value]="filterSearchTerms.fromWhere || getSelectedLocationName(FromWhereId)"
                        (focus)="openFilterDropdown('fromWhere')"
                        (input)="onFilterSearchLocation($event, 'fromWhere')"
                        (click)="openFilterDropdown('fromWhere')">
                    <span class="dropdown-arrow" (click)="toggleFilterDropdown('fromWhere')">‚ñº</span>
                    
                    <div class="dropdown-list" *ngIf="filterDropdownStates.fromWhere">
                        <div class="dropdown-item" 
                             (click)="selectFilterLocation({locationId: 0, locationName: 'Kh√¥ng ch·ªçn'}, 'fromWhere')"
                             [class.selected]="FromWhereId === 0">
                            Kh√¥ng ch·ªçn
                        </div>
                        <div class="dropdown-item" 
                             *ngFor="let l of filteredFilterLocations.fromWhere" 
                             (click)="selectFilterLocation(l, 'fromWhere')"
                             [class.selected]="FromWhereId === l.locationId">
                            {{l.locationName}}
                        </div>
                        <div *ngIf="filteredFilterLocations.fromWhere.length === 0" class="no-results">
                            Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- C·∫£ng h·∫°/tr·∫£ Cont Filter -->
        <div class="filter-group">
            <label class="filter-label">C·∫£ng h·∫°/tr·∫£ Cont</label>
            <div class="dropdown-container">
                <div class="dropdown-wrapper" [class.active]="filterDropdownStates.toLocation">
                    <input 
                        type="text" 
                        class="dropdown-search filter-dropdown" 
                        placeholder="Ch·ªçn c·∫£ng h·∫°..."
                        [value]="filterSearchTerms.toLocation || getSelectedLocationName(ToLocationId)"
                        (focus)="openFilterDropdown('toLocation')"
                        (input)="onFilterSearchLocation($event, 'toLocation')"
                        (click)="openFilterDropdown('toLocation')">
                    <span class="dropdown-arrow" (click)="toggleFilterDropdown('toLocation')">‚ñº</span>
                    
                    <div class="dropdown-list" *ngIf="filterDropdownStates.toLocation">
                        <div class="dropdown-item" 
                             (click)="selectFilterLocation({locationId: 0, locationName: 'Kh√¥ng ch·ªçn'}, 'toLocation')"
                             [class.selected]="ToLocationId === 0">
                            Kh√¥ng ch·ªçn
                        </div>
                        <div class="dropdown-item" 
                             *ngFor="let l of filteredFilterLocations.toLocation" 
                             (click)="selectFilterLocation(l, 'toLocation')"
                             [class.selected]="ToLocationId === l.locationId">
                            {{l.locationName}}
                        </div>
                        <div *ngIf="filteredFilterLocations.toLocation.length === 0" class="no-results">
                            Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Date Range Filter -->
        <div class="filter-group">
            <label class="filter-label">T·ª´ ng√†y</label>
            <input type="date" class="filter-input" [(ngModel)]="fromDateStr">
        </div>

        <div class="filter-group">
            <label class="filter-label">ƒê·∫øn ng√†y</label>
            <input type="date" class="filter-input" [(ngModel)]="toDateStr">
        </div>

        <!-- Page Size -->
        <div class="filter-group">
            <label class="filter-label">Hi·ªÉn th·ªã</label>
                <select class="filter-select"  (change)="showEntries($event)">
                    <option value="9" >9 b·∫£n ghi</option>
                    <option value="13">13 b·∫£n ghi</option>
                    <option value="17">17 b·∫£n ghi</option>
                    <option value="25">25 b·∫£n ghi</option>
                </select>        
        </div>

        <!-- Search Button -->
        <div class="filter-group">
            <label class="filter-label">&nbsp;</label>
            <button class="btn-search" (click)="onSearch()">
                üîç T√¨m ki·∫øm
            </button>
        </div>
        
    </div>

    <!-- Table -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>C·∫£ng nh·∫≠n Cont</th>
                    <th>Kho nh·∫≠n/Giao h√†ng</th>
                    <th>C·∫£ng h·∫°/tr·∫£ Cont</th>
                    <th>Ti·ªÅn l∆∞∆°ng(ƒë∆°n v·ªã t√≠nh VND)</th>
                    <th>Ng∆∞·ªùi t·∫°o ƒë∆°n</th>
                    <th>Ng√†y √°p d·ª•ng</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody id="driverTableBody">
                <tr *ngIf="listTranscost.length === 0" class="empty-state">
                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
                            <div style="font-size: 16px; margin-bottom: 8px;">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                            <div style="font-size: 14px;">Vui l√≤ng ch·ªçn ƒëi·ªÅu ki·ªán l·ªçc Ho·∫∑c Click v√†o n√∫t "T√¨m ki·∫øm" ƒë·ªÉ hi·ªÉn th·ªã c√°c b·∫£n ghi m·ªõi nh·∫•t</div>
                        </div>
                    </td>
                </tr>
                <tr *ngFor="let trans of listTranscost,index as i">
                    <td>{{trans.transcostID}}</td>
                    <td>{{trans.fromLocationName}}</td>
                    <td>{{trans.fromWhereName}}</td>
                    <td>{{trans.toLocationName}}</td>
                    <td>
                        <input type="text" 
                            [value]="trans.cost | number:'1.0-0':'en-US'" 
                            (input)="onCostInput($event, trans)"
                            (blur)="onCostBlur($event, trans)"
                            class="cost-input">
                    </td>
                    <td>{{trans.createdByName}}</td>
                    <td>{{trans.createdDate | date: 'dd/MM/yyyy'}}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-edit" 
                                    (click)="updateCost(trans.transcostID, trans.cost, i)">
                                C·∫≠p nh·∫≠t gi√°
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Add -->
<div class="modal-overlay" [class.show]="isAddModalOpen" (click)="onOverlayClick($event, 'add')">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">{{modalTitle}}</h2>
            <button class="modal-close" (click)="closeAddModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="driverForm" (ngSubmit)="saveTranscost()">
                <!-- C·∫£ng nh·∫≠n Cont -->
                <div class="form-group">
                    <label class="form-label">
                        C·∫£ng nh·∫≠n Cont <span class="required">*</span>
                    </label>
                    <div class="dropdown-container">
                        <div class="dropdown-wrapper" [class.active]="dropdownStates.fromLocation">
                            <input 
                                type="text" 
                                class="dropdown-search" 
                                placeholder="T√¨m ki·∫øm C·∫£ng nh·∫≠n Cont..."
                                [value]="searchTerms.fromLocation || getSelectedLocationName(TranscostForm.FromLocationId)"
                                (focus)="openDropdown('fromLocation')"
                                (input)="onSearchLocation($event, 'fromLocation')"
                                (click)="openDropdown('fromLocation')">
                            <span class="dropdown-arrow" (click)="toggleDropdown('fromLocation')">‚ñº</span>
                            
                            <div class="dropdown-list" *ngIf="dropdownStates.fromLocation">
                                <div class="dropdown-item" 
                                     *ngFor="let l of filteredLocations.fromLocation" 
                                     (click)="selectLocation(l, 'fromLocation')"
                                     [class.selected]="TranscostForm.FromLocationId === l.locationId">
                                    {{l.locationName}}
                                </div>
                                <div *ngIf="filteredLocations.fromLocation.length === 0" class="no-results">
                                    Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kho nh·∫≠n/Giao h√†ng -->
                <div class="form-group">
                    <label class="form-label">
                        Kho nh·∫≠n/Giao h√†ng <span class="required">*</span>
                    </label>
                    <div class="dropdown-container">
                        <div class="dropdown-wrapper" [class.active]="dropdownStates.fromWhere">
                            <input 
                                type="text" 
                                class="dropdown-search" 
                                placeholder="T√¨m ki·∫øm Kho nh·∫≠n/Giao h√†ng..."
                                [value]="searchTerms.fromWhere || getSelectedLocationName(TranscostForm.FromWhereId)"
                                (focus)="openDropdown('fromWhere')"
                                (input)="onSearchLocation($event, 'fromWhere')"
                                (click)="openDropdown('fromWhere')">
                            <span class="dropdown-arrow" (click)="toggleDropdown('fromWhere')">‚ñº</span>
                            
                            <div class="dropdown-list" *ngIf="dropdownStates.fromWhere">
                                <div class="dropdown-item" 
                                     *ngFor="let l of filteredLocations.fromWhere" 
                                     (click)="selectLocation(l, 'fromWhere')"
                                     [class.selected]="TranscostForm.FromWhereId === l.locationId">
                                    {{l.locationName}}
                                </div>
                                <div *ngIf="filteredLocations.fromWhere.length === 0" class="no-results">
                                    Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- C·∫£ng h·∫°/tr·∫£ Cont -->
                <div class="form-group">
                    <label class="form-label">
                        C·∫£ng h·∫°/tr·∫£ Cont <span class="required">*</span>
                    </label>
                    <div class="dropdown-container">
                        <div class="dropdown-wrapper" [class.active]="dropdownStates.toLocation">
                            <input 
                                type="text" 
                                class="dropdown-search" 
                                placeholder="T√¨m ki·∫øm C·∫£ng h·∫°/tr·∫£ Cont..."
                                [value]="searchTerms.toLocation || getSelectedLocationName(TranscostForm.ToLocationId)"
                                (focus)="openDropdown('toLocation')"
                                (input)="onSearchLocation($event, 'toLocation')"
                                (click)="openDropdown('toLocation')">
                            <span class="dropdown-arrow" (click)="toggleDropdown('toLocation')">‚ñº</span>
                            
                            <div class="dropdown-list" *ngIf="dropdownStates.toLocation">
                                <div class="dropdown-item" 
                                     *ngFor="let l of filteredLocations.toLocation" 
                                     (click)="selectLocation(l, 'toLocation')"
                                     [class.selected]="TranscostForm.ToLocationId === l.locationId">
                                    {{l.locationName}}
                                </div>
                                <div *ngIf="filteredLocations.toLocation.length === 0" class="no-results">
                                    Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Ti·ªÅn l∆∞∆°ng<span class="required">*</span>
                    </label>
                    <input type="number" class="form-input" id="cost" [(ngModel)]="TranscostForm.cost" name="cost" required>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" (click)="closeAddModal()">H·ªßy</button>
                    <button type="submit" class="btn-save">{{isEditMode ? 'C·∫≠p nh·∫≠t' : 'L∆∞u'}}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="pagination-container pagination-fade-in">
    <!-- Info Text -->
    <div class="pagination-info">
        T·ªïng <strong>1-10</strong> c·ªßa <strong>156</strong> k·∫øt qu·∫£
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-controls">
        <!-- Previous Button -->
        <button class="pagination-btn nav-btn prev" [disabled]="pageNumber === 1" (click)="changePage(pageNumber - 1)">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
            </svg>
            Tr∆∞·ªõc
        </button>

        <!-- Page Numbers -->
        <button class="pagination-btn" [class.active]="pageNumber === 1" (click)="changePage(1)">1</button>
        <button class="pagination-btn" [class.active]="pageNumber === 2" (click)="changePage(2)">2</button>
        <button class="pagination-btn" [class.active]="pageNumber === 3" (click)="changePage(3)">3</button>
        <button class="pagination-btn mobile-hidden" [class.active]="pageNumber === 4"
            (click)="changePage(4)">4</button>
        <button class="pagination-btn mobile-hidden" [class.active]="pageNumber === 5"
            (click)="changePage(5)">5</button>

        <!-- Ellipsis -->
        <span class="pagination-ellipsis mobile-hidden">...</span>

        <!-- Last Page -->
        <button class="pagination-btn mobile-hidden" [class.active]="pageNumber === 16"
            (click)="changePage(16)">16</button>

        <!-- Next Button -->
        <button class="pagination-btn nav-btn next" [disabled]="pageNumber === 16" (click)="changePage(pageNumber + 1)">
            Sau
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                    clip-rule="evenodd" />
            </svg>
        </button>
    </div>
</div>